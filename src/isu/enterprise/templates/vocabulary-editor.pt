<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="main.macros['page']">
    <tal:block metal:fill-slot="header-meta">
        <style>
         /* Font Definitions */
         /*
            table {
            border-collapse: collapse;
            }

            table, th, td {
            border: 1px solid black;
            }
          */
         .simple_table {
             margin: 1em;
             width: 75%;
         }

         .hidden {
             display: none;
         }
        </style>
    </tal:block>
    <tal:block metal:fill-slot="content">
        <div>
            Factory name :
            <span tal:content="context.factory_name"></span><br/>
        </div>
        <table class="table table-striped simple_table" id="vocabulary-editor">
            <thead>
                <tr>
                    <th class="hidden">#</th>
                    <th>id</th>
                    <th>name</th>
                    <th>&nbsp;</th>
                </tr>
            </thead>
            <tbody id="insertion-point">
                <tr tal:repeat="term view.terms"
                    tal:attributes="id view.uuid(term)"
                >
                    <td tal:content="repeat['term'].number" class="hidden">N</td>
                    <td
                        tal:content="term.id"
                        tal:attributes="id term.id"
                    >id</td>
                    <td tal:content="term.name">name</td>
                    <td><button class="btn btn-primary isu-delete-btn"> Delete </button>
                        <button class="btn btn-primary isu-edit-btn"> Edit </button></td>
                </tr>
            </tbody>
        </table>
        <div class="btn-group">
            <button type="button" class="btn btn-primary"
                    id="add-button">Add</button>
        </div>
        <div id="e">
        </div>
    </tal:block>
    <tal:block metal:fill-slot="script-src">
        <script type="text/javascript">
            function rowDelete(){
            $(this).parent().parent().remove();
            };

            $("#add-button").click(function(){
            var ip = $("#insertion-point");
            uuid = generateUUID();
            ip.append(`
            <tr id="`+uuid+`">
                <td class="hidden">&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>
                    <button class="btn btn-primary isu-delete-btn"> Delete </button>
                    <button class="btn btn-primary isu-edit-btn"> Edit </button>
                </td>
            </tr>
            `);

            var rows=$("#"+uuid);
            var btns=rows.find(".isu-delete-btn");
            btns.click(rowDelete);

            });

            $(".isu-delete-btn").click(rowDelete);

            function generateUUID () { // Public Domain/MIT
            var d = new Date().getTime();
            if (typeof performance !== 'undefined' && typeof performance.now === 'function'){
            d += performance.now(); //use high-precision timer if available
            }
            return 'xxxxxxxx-xxxx-8xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = (d + Math.random() * 16) % 16 | 0;
            d = Math.floor(d / 16);
            return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
            }
        </script>
    </tal:block>
</html>
